//API KEY: iZpEPEE9yi6m9N2a6Bzu5KL8bFVielx0
//program that communicates with Gify API and brings down 10 results of gifs based on what button is clicked
//buttons are generated by an array of topics that is looped through to create them
//gifs are displayed with their ratings as well
//all gifs can be paused and played 


var initialArray = ["Tim and Eric", "sweet drift", "Gucci Mane"];
var buttonDiv = $("#button-container")
var gifDiv = $("#gif-container");
var currentGifObject = undefined;

function displayButtons(){
    buttonDiv.empty();
    for(var i = 0; i < initialArray.length; i++){
 
        var newButton = $("<button class = 'topic btn btn-primary' data-topic = '" + initialArray[i] + "'>")
        console.log(newButton);
        console.log(initialArray[i]);
        newButton.text(initialArray[i]);
        buttonDiv.append(newButton);
    };
};

function displayGifs(queryURL){
    gifDiv.empty();
        $.ajax({
            url: queryURL,
            method: "GET"
        }).then(function(response){
    
            var results = response.data;
            currentGifObject = response.data;
            console.log
            for (var i = 0; i < results.length; i++ ){
                var newDiv = $("<div id = 'item'" + i + ">")
                gifDiv.append(newDiv);
                var rating = results[i].rating;
                var p = $("<p>").text("Rating " + rating);
                var image = $("<img class = 'gif' data-number = " + i + ">").attr("src", results[i].images.fixed_height_still.url);
                newDiv.prepend(image);
                newDiv.prepend(p);

            }
        });
};

function pauseGif(gifIterator, clickedGif) {
    console.log("it works!");
    var pause = currentGifObject[gifIterator].images.fixed_height_still.url;
    var play = currentGifObject[gifIterator].images.fixed_height.url;
    var current = clickedGif.attr("src")
    if(current === play){
        clickedGif.attr("src", pause);
    } else {
        clickedGif.attr("src", play);
    }
};

$(document).ready(function(){
    displayButtons();

    $("#button-container").on("click", "button", function() {
        console.log("running");

        var searchTerm = $(this).attr("data-topic");
        var queryURL = "https://api.giphy.com/v1/gifs/search?q=" + searchTerm + "&api_key=iZpEPEE9yi6m9N2a6Bzu5KL8bFVielx0&limit=10&rating=pg";
        displayGifs(queryURL);
        
    });

    $("#add-button").on("click", function(event){
        event.preventDefault();
        var topic = $("#button-input").val().trim();
        //only runs if there is text in the field and it is not a duplicate of another button
        if(topic.length > 0 && initialArray.includes(topic) == false){
            initialArray.push(topic);
            displayButtons();
        }

    });

    $("#gif-container").on("click", ".gif", function(){
        var gifIterator = $(this).attr("data-number")
        pauseGif(gifIterator, $(this))
    });


});
